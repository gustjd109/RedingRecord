# CHAPTER09 : 가상메모리(Virtual Memory)

## 9.9 동적 메모리 할당
- 가상메모리의 영역을 저수준의 mmap과 munmap 함수를 사용해서 생성하고 삭제할 수 있음
    - C프로그래머들은 대개 추가적인 가상메모리를 런타임에 획득할 필요가 있으르 때, 동적 메모리 할당기를 사용하는 것을 좀 더 편리하고 호환성이 좋다고 생각
- 동적 메모리 할당기
    - 힙(heap)이라고 하는 프로세스의 가상메모리 영역을 관리
    - 시스템마다 다르지만, 일반화의 오류를 범하지 않는 한도에서 힙이 미초기화된 데이터 영역 직후에 시작해서 위쪽으로(높은 주소 방향으로) 커지는 무요구 메모리 영역이라고 가정할 것
    - 각각의 프로세스에 대해서, 커널은 힙의 꼭대기를 가리키는 변수 brk(break)를 사용
    - 힙을 다양한 크기의 블록들의 집합으로 관리
        - 블록은 할당되었거나 가용한 가상메모리의 연속적인 묶음
    - 할당된 블록은 응용하기 위해 명시적으로 보존됨
    - 가용한(free) 블록은 할당을 위해 사용할 수 있고, 응용이 명시적으로 할당할 때까지 가용한 상태로 남아 있음
    - 할당된 블록은 응용에 의해 명시적으로 또는 메모리 할당기 자신에 의해 묵시적으로 반환될 때까지 할당된 채로 남아 있음
    - 두개의 기본 유형
        - 두 유형 모두는 응용이 명시적으로 블록을 할당하도록 요구
        - 어떤 엔트리가 할당된 블록을 반환하기 위해서 무엇이 사용되어야 하는지에 대해서 차이가 남
        - 명시적인 할당기
            - 응용이 명시적으로 할당된 블록을 반환해 줄 것을 요구
            - 예를 들어, C 표준 라이브러리는 malloc 패키지라고 하는 명시적 할당기를 제공
                - malloc 함수를 호출해서 블록을 할당
                - free 함수를 호출해서 블록을 반환
            - C++ 에서는 new와 delete를 호출하여 블록을 할당 및 반환
        - 묵시적 할당기
            - 언제 할당된 블록이 더 이상 프로그램에 의해 사용되지 않고 블록을 반환하는지를 할당기가 검출할 수 있을 것을 요구
            - 묵시적 할당기는 가비지 컬렉터(garbage collector)라고 알려지 있음
                - 자동으로 사용하지 않은 할당된 블록을 반환시켜주는 작업을 가비지 컬렉션이라고 부름
                - List, ML, 자바 같은 상위수준 언어들은 할당된 블록들을 반환시키기 위해 가비지 컬렉션을 사용

## 9.9.1 malloc과 free 함수
- C 표준 라이브러리는 malloc 패키지로 알려진 명시적인 할당기를 제공
- 프로그램은 malloc 함수를 호출해서 힙으로부터 블록들을 할당받음
